
name: Create and publish a Docker image

on:
  push:
    branches: ['main']


env:
  REGISTRY: ghcr.io
  IMAGE_NAME: app-backend


jobs:
  sonar:
    name: Sonar
    runs-on: actions-runner-set
    steps:
    - uses: actions/checkout@v4
      with:
        fetch-depth: 0
    - name: SonarQube Scan
      uses: sonarsource/sonarqube-scan-action@v4.1.0
      with:
        projectBaseDir: App/Communitter
        args: >
          -Dsonar.projectKey=my-projectkey
      env:
        SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
        SONAR_HOST_URL: ${{ vars.SONAR_HOST_URL }}

  # build-and-push-image:
  #   runs-on: actions-runner-set
  #   steps:
  #     - name: set lower case owner name
  #       env:
  #         ACTOR: '${{ github.actor}}'
  #       run: |
  #         echo "ACTOR_LC=${ACTOR,,}" >>${GITHUB_ENV}

  #     - name: Checkout repository
  #       uses: actions/checkout@v4

  #     - name: Log in to the Container registry
  #       uses: docker/login-action@65b78e6e13532edd9afa3aa52ac7964289d1a9c1
  #       with:
  #         registry: ${{ env.REGISTRY }}
  #         username: ${{ github.actor }}
  #         password: ${{ secrets.GH_PAT }}

  #     - name: Build and push Docker image
  #       id: push
  #       uses: docker/build-push-action@f2a1d5e99d037542a71f64918e516c093c6f3fc4
  #       with:
  #         context: ./App/Communitter
  #         file: ./App/Communitter/API.Dockerfile
  #         push: true
  #         tags: ${{ env.REGISTRY }}/${{ env.ACTOR_LC }}/${{ env.IMAGE_NAME }}:latest
          
 
      
